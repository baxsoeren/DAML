---
title: "Einkaufsgewohnheiten in den USA"
title-block-banner: true
lang: de
author: Ole Kepa,<br>
        Fabian Elsner,<br>
        Sören Bax
format: 
  html: 
    theme: flatly 
    toc: true
    toc_float: true
    number-sections: true
    embed-resources: true
    code-fold: true
    code-summary: "Code anzeigen"
date: 2023-12-23
---
<!-- 
  pdf: 
    toc: true
    number-sections: true
    
THEMES: https://quarto.org/docs/output-formats/html-themes.html -->

```{r, message=FALSE, include = FALSE}
library(tidyverse) 
library(tidymodels)
library(explore)
library(ggplot2)
library(usmap)
```


# Gendererklärung
Aus Lesbarkeitsgründen wird in dieser Studienarbeit auf die verschiedene Ansprechweisen, sei es divers, männlich oder weiblich verzichtet. Alle Formulierungen sprechen gleichermaßen alle Geschlechter an.

# Aufgabe und Daten verstehen

In dieser Arbeit soll untersucht werden, wie das Kaufverhalten der Käufer in den USA ist. Anschließend sollen mehrere Modelle entwickelt werden, welche Beispielsweise voraussagen, ob `[...].`

Hierzu steht ein Dataset zu dem Kaufverhalten von Verbrauchern in den USA zur Verfügung, das unter <https://www.kaggle.com/datasets/zeesolver/consumer-behavior-and-shopping-habits-dataset/data> abgerufen werden kann.

Dieses Datenset beinhaltet insgesamt zwei CSV-Dateien, welche sich jedoch nur in einem Spaltennamen und nicht in den Daten unterscheiden. Die Spalte zur Zahlungsmethode heißt in der Datei "shopping_behavior_updated.csv" "Payment Method" und in der Datei "shopping_trend.csv" "Preferred Payment Method". Wir nutzen daher nur die CSV-Datei "shopping_behavior_updated.csv".

## Beschreibung der Datenquelle

Laden wir zuerst die Daten:

```{r, message=FALSE}
raw_shopping_behavior <- read_csv('./data/shopping_behavior_updated.csv')
```

Nun werfen wir einen kurzen Blick auf die Daten und das Spaltenformat:

```{r}
knitr::kable(head(raw_shopping_behavior), caption = "Das Spaltenformat des Datensatzes 'shopping_behavior'")
```

Jede Zeile steht für einen Einkauf. Die Spalten sind wie folgt definiert:

Variable                    |Typ    |Bedeutung
:---------------------------|:------|:------------------------------------
**Customer ID**             |dbl    | Eindeutige Kunden Identifikationsnummer
**Age**                     |dbl    | Alter des Kundens
**Gender**                  |chr    | Geschlecht des Kundens
**Item Purchased**          |chr    | Gekauftes Produkt
**Category**                |chr    | Kategorie des gekauften Produkts
**Purchase Amount**         |dbl    | Bezahlter Preis
**Location**                |chr    | Ort des Kaufes
**Size**                    |chr    | Konfektionsgröße des gekauften Produkts
**Color**                   |chr    | Farbe des gekauften Produkts
**Season**                  |chr    | Jahreszeit, in welcher der Kauf getätigt wurde
**Review Rating**           |dbl    | Kundenbewertungen zum Produkt
**Subscription Status**     |chr    | Status des Abonnements
**Payment Method**          |chr    | Zahlungsmethode
**Shipping Type**           |chr    | Versandart
**Discount Applied**        |chr    | Rabattcode genutzt?
**Promo Code Used**         |chr    | Werbecode genutzt?
**Previous Purchases**      |dbl    | Anzahl vorheriger Käufe
**Payment Method**          |chr    | Bevorzugte Zahlungsmethode
**Frequency of Purchases**  |chr    | Häufigkeit von Käufen



```{r}
describe_tbl(raw_shopping_behavior)
```

Im Datensatz gibt es **`r nrow(raw_shopping_behavior)`** Instazen (Beobachtungen) und **`r ncol(raw_shopping_behavior)`** Spalten. Die Daten sind bereits *tidy*, was bedeutet, dass jede Variable ihre eigene Spalte, jede Beobachtung seine eigene Zeile und jeder Wert seine eigene Zelle hat. Die Daten sind bereits *bereinigt*, was bedeutet, dass sie keine fehlenden Werte enthalten.

## Thesen

Wir möchten insbesondere folgende Thesen in dieser Arbeit untersuchen:

**These 1: Die meisten Personen kaufen wöchentlich ein.**

**These 2: Die meisten Klamotten sind in den Farben Schwarz, Weiß oder Grau.**

**These 3: Die meisten Kunden zahlen Bar.**

**These 4: Die meisten Kunden nutzen keinen Rabattcode.**

**These 5: Männer kaufen weniger ein als Frauen.**

**These 6: Es werden mehr Winter als Sommerklamotten gekauft.**

**These 7: Die meisten Klamotten werden im Norden gekauft.**

**These 8: Die Kategorie "Klamotten" wird am meisten gekauft.**

**These 9: Es kaufen mehr Personen über 40 Jahre ein, als Personen unter 40 Jahren.**

# Untersuchung der Daten

## Untersuchung auf Außreißer

Um die Daten auf außreiser zu untersuchen schauen wir uns zunächst eine Zusammenfassung der Daten an:

```{r}
summary(raw_shopping_behavior)
```

```{r}
raw_shopping_behavior %>% describe()
```

Die Customer ID ist für Analysen nicht verwertbar. Wir können Sie im nächsten Schritt löschen. 

## Datenaufbereitung

Nun erstellen wir den finalen Datensatz, welcher die Basis für die weitere Analyse bildet. Zunächst löschen wir die Spalte "Customer ID", da diese für Analysen nicht verwertbar ist:

```{r}
shopping_behavior <- raw_shopping_behavior |> select(-"Customer ID")
```

**MUSS HIER WAS KONVERTIERT WERDEN?**

Season in numerisch umwandeln (1, 2, 3, 4)

Frequency of Purchases umwandeln in Zahl


**PREISGURPPEN BILDEN**

Werfen wir einen Blick auf das finale Datenset.

```{r}
#final_shopping_behavior
knitr::kable(head(shopping_behavior), caption = "Das Spaltenformat des finalen Datensatzes")
```


# Untersuchung der Thesen

Im folgenden werden die Thesen mit den Methoden der emplorativen Datenanalyse untersucht.

## These 1 (Ole)

Histogramm für die Häufigkeit von Einkäufen
Zusammenfassende Statistiken
Drucke das Histogramm und die Zusammenfassung

## These 2 (Ole)

Zunächst schauen wir uns einmal alle vorhandenen Farben an:

```{r}
rows <- nrow(shopping_behavior |> distinct(Color))
print(shopping_behavior |> distinct(Color), n = rows)
```

Wir sehen, dass es `r nrow(shopping_behavior |> distinct(Color))` Farben gibt. Nun schauen wir uns die Häufigkeit der Farben an:

```{r}
rows <- nrow(shopping_behavior |> distinct(Color))
print(shopping_behavior |> count(Color) |> arrange(desc(n)) , n = rows)

```

Wir sehen, dass die Farben Schwarz, Weiß und Grau am häufigsten vorkommen. Nun schauen wir uns die Häufigkeit der Farben an, die nicht Schwarz, Weiß oder Grau sind:

```{r}
rows <- nrow(shopping_behavior |> distinct(Color))
print(shopping_behavior |> filter(Color != "Black" & Color != "White" & Color != "Gray") |> count(Color) |> arrange(desc(n)) , n = rows)

```

Wir sehen, dass die Farben Schwarz, Grau und Weiß <Prozent> an der gesamten Farbauswahl einnehmen

```{r}
result <- shopping_behavior %>%
  count(Color) %>%
  mutate(Percentage = n / sum(n) * 100) %>%
  filter(Color %in% c("Black", "Gray", "White")) %>%
  summarize(
    Gesamtanteil = sum(Percentage),
    Anteil_Schwarz = sum(Percentage[Color == "Black"]),
    Anteil_Grau = sum(Percentage[Color == "Gray"]),
    Anteil_Weiß = sum(Percentage[Color == "White"])
  )

# Ergebnis anzeigen
print(result)
```

Dies zeigt uns, dass die These, dass die Farben Schwarz, Grau und Weiß am häufigsten gekauft werden, nicht stimmt. Zur verdeutlichung wird ein Balkendiagramm erstellt.

```{r}
## Daten vorbereiten (falls nicht bereits vorhanden)
data <- shopping_behavior %>%
  count(Color)

# Farbpalette erstellen
color_palette <- c(
  "Gray" = "#808080",
  "Maroon" = "#800000",
  "Turquoise" = "#40E0D0",
  "White" = "#FFFFFF",
  "Charcoal" = "#36454F",
  "Silver" = "#C0C0C0",
  "Pink" = "#FFC0CB",
  "Purple" = "#800080",
  "Olive" = "#808000",
  "Gold" = "#FFD700",
  "Violet" = "#EE82EE",
  "Teal" = "#008080",
  "Lavender" = "#E6E6FA",
  "Black" = "#000000",
  "Green" = "#008000",
  "Peach" = "#FFDAB9",
  "Red" = "#FF0000",
  "Cyan" = "#00FFFF",
  "Brown" = "#A52A2A",
  "Beige" = "#F5F5DC",
  "Orange" = "#FFA500",
  "Indigo" = "#4B0082",
  "Yellow" = "#FFFF00",
  "Magenta" = "#FF00FF",
  "Blue" = "#0000FF"
)

# Balkendiagramm erstellen
ggplot(data, aes(x = Color, y = n, fill = Color)) +
  geom_bar(stat = "identity") +
  labs(title = "Häufigkeit der Farben", x = "Farbe", y = "Häufigkeit") +
  scale_fill_manual(values = color_palette) +
  theme_minimal() + 
  theme(axis.text.x = element_blank())



```


## These 3 (Ole)

## These 4 (Fabian)
In dieser These wird die Hypothese geprüft, dass die meisten Kunden keine Rabattcodes nutzen würden. 

## These 5 (Fabian)
In dieser These wird die Hypothese geprüft, dass Männer weniger Produkte einkaufen als Frauen. 

## These 6 (Fabian)
In dieser These wird die Hypothese geprüft, dass im Winter mehr Kleidung gekauft wird als im Sommer.

## These 7 (Sörn)

Zunächst schauen wir uns  einmal alle vorhandenen Orte an:

```{r}
shopping_behavior |> distinct(Location)
```

Wir sehen, dass es `r nrow(shopping_behavior |> distinct(Location))` Orte gibt. Nun schauen wir uns die Häufigkeit der  einzelnen Orte an:

```{r}
rows <- nrow(shopping_behavior |> distinct(Location))
print(shopping_behavior |> count(Location) |> arrange(desc(n)) , n = rows)
```

Nun erstellen wir eine Heatmap über die Häufigkeit der Orte:

```{r}
# Werte aus der Tabelle shopping_behavior übernommen
df <- data.frame(
  state  = c("Montana", "California", "Idaho", "Illinois", "Alabama", "Minnesota", "Nebraska", "Nevada", "New York", "Delaware",
             "Maryland", "Vermont", "Louisiana", "North Dakota", "Missouri", "New Mexico", "West Virginia","Mississippi", "Arkansas", "Georgia",
             "Indiana", "Kentucky", "Connecticut", "North Carolina", "Maine", "Ohio", "Tennessee", "Texas", "Virginia", "South Carolina",
             "Colorado", "Oklahoma", "Wisconsin", "Oregon", "Pennsylvania", "Michigan", "Washington", "Alaska", "Massachusetts", "New Hampshire",
             "New Hampshire", "Utah", "Wyoming", "South Dakota", "Iowa", "Florida", "New Jersey", "Arizona", "Hawaii", "Kansas",
             "Rhode Island"),
  occurrence = c(96, 95, 93, 92, 89, 88, 87, 87, 87, 86,
                 86, 85, 84, 83, 81, 81, 81, 80, 79, 79,
                 79, 79, 78, 78, 77, 77, 77, 77, 77, 76,
                 75, 75, 75, 74, 74, 73, 73, 72, 72, 71,
                 71, 71, 71, 70, 69, 68, 67, 65, 65, 63,
                 63)
)

plot_usmap(data = df, values = "occurrence", color = "black", labels = TRUE) + 
  scale_fill_continuous(
    low = "white", high = "red", name = "Häufigkeit", label = scales::comma
  ) + theme(legend.position = "right")
```


## These 8 (Sörn)

Zunächst schauen wir uns einmal alle vorhandenen Kategorien an:

```{r}
shopping_behavior |> distinct(Category)
```

Wir sehen, dass es 4 Kategorien gibt: Klamotten, Schuhe, Accessoires und Oberbekleidung Nun schauen wir uns die Häufigkeit der Kategorien an:

```{r}
shopping_behavior |> count(Category)

shopping_behavior |> count(Category) |> ggplot(aes(x = Category, y = n)) + geom_col()
```

Wir sehen, dass die Kategorie "Klamotten" mit 1737 Instanzen am häufigsten vorkommt.Danach folgt die Kategorie "Accessoires" mit 1240 Instanzen. Am seltensten kommen die Kategorien "Schuhe" mit 599 und "Oberbekleidung" mit 324 Instanzen vor.

## These 9 (Sörn)

```{r}
hist(shopping_behavior$Age)
```

Einkauf mit dem höchsten Alter:

```{r, message=FALSE}
shopping_behavior |> arrange(desc(Age)) |> head(1)
```

Einkauf mit dem niedrigsten Alter:

```{r, message=FALSE}
shopping_behavior |> arrange(Age) |> head(1)
```

Berechnen wir Mittelwert und Median.

```{r}
shopping_behavior |> summarise(mean(Age), median(Age))

mean_behavior <- as.double(mean(shopping_behavior$Age))
med_behavior <- as.integer(median(shopping_behavior$Age))
```

Der Mittelwert `r mean_behavior` ist nicht robust gegenüber Ausreißern, deswegen ist der deutlich höher als der Median mit dem Wert `r med_behavior`.

Die Spannweite des Alters ist:

```{r}
max(shopping_behavior$Age) - min(shopping_behavior$Age)
```

Nun erstellen wir einen Boxplot für das Alter:

```{r}
ggplot(shopping_behavior, aes(x = Age)) + 
  geom_boxplot() +
  coord_flip() +
  labs(
    x = "Alter",
    title = "Boxplot der Lebensjahre der Kunden", 
  ) +
  scale_y_discrete(labels = NULL, breaks = NULL)  +
  scale_x_continuous(
    labels = comma_format(big.mark = ".", 
                          decimal.mark = ","))
```


# Anwendung und Beurteilung von Machine-Learning-Modellen

## Modell 1 (Ole)

### Anwendung

### Beurteilung

## Modell 2 (Ole)

### Anwendung

### Beurteilung

## Modell 3 (Fabian)

### Anwendung

### Beurteilung

## Modell 4 (Fabian)

### Anwendung

### Beurteilung

## Modell 5 (Sörn) -- Entscheidungsbaum über das Alter & der Kauf einer Kategorie

### Anwendung

### Beurteilung

## Modell 6 (Sörn)

### Anwendung

### Beurteilung

# Fazit

## Bewertung

Ich finde das sehr Kritisch und nicht schön

## Ideen für weitere Analysen

# Quellen

Datenset: <https://www.kaggle.com/datasets/zeesolver/consumer-behavior-and-shopping-habits-dataset/data> <br>
US-Map: <https://jtr13.github.io/cc19/different-ways-of-plotting-u-s-map-in-r.html> <br>
US-Map 2: <https://cran.r-project.org/web/packages/usmap/vignettes/mapping.html> <br>

# Ehrenwörtliche Erklärung
Hiermit erklären wir, dass wir die vorliegende Studienarbeit (Produktstudie) selbständig angefertigt haben und die Bearbeiter der einzelnen Abschnitte wahrheitsgemäß angegeben haben. Es wurden nur die in der Arbeit ausdrücklich benannten Quellen und Hilfsmittel benutzt. Wörtlich oder sinngemäß übernommenes Gedankengut haben wir als solches kenntlich gemacht. Diese Arbeit hat in gleicher oder ähnlicher Form ganz oder teilweise noch keiner Prüfungsbehörde vorgelegen.

<!-- Unterschriften in HTML -->
<img src="./signatures/OleKepa.png" height="50" width="150"> <img src="./signatures/FabianElsner.png" height="50" width="150"> <img src="./signatures/SoerenBax.png" height="50" width="150">

<!-- Unterschriften in PDF einbinden -->
\includegraphics{"./signatures/OleKepa.png"} \includegraphics{"./signatures/OleKepa.png"} \includegraphics{"./signatures/OleKepa.png"}