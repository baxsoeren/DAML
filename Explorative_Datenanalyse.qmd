---
title: "Einkaufsgewohnheiten in den USA"
subtitle: ""
title-block-banner: true
lang: de
author: Ole Kepa,<br>
        Fabian Elsner,<br>
        Sören Bax
format: 
  html: 
    theme: flatly 
    toc: true
    toc_float: true
    number-sections: true
    embed-resources: true
    code-fold: true
    code-summary: "Code anzeigen"
date: 2023-12-23
---
<!-- 
  pdf: 
    toc: true
    number-sections: true
    
THEMES: https://quarto.org/docs/output-formats/html-themes.html -->

```{r, message=FALSE, include = FALSE}
library(tidyverse) 
library(tidymodels)
library(explore)
library(ggplot2)
```


# Gendererklärung
Aus Lesbarkeitsgründen wird in dieser Studienarbeit auf die verschiedene Ansprechweisen, sei es divers, männlich oder weiblich verzichtet. Alle Formulierungen sprechen gleichermaßen alle Geschlechter an.

# Aufgabe und Daten verstehen

In dieser Arbeit soll untersucht werden, wie das Kaufverhalten und die Kauftrends der Kunden in den USA ist. Anschließend sollen mehrere Modelle entwickelt werden, welche Beispielsweise voraussagen, ob `[...].`

Hierzu steht ein Dataset zu dem Kaufverhalten der Verbraucher in den USA zur Verfügung, das unter <https://www.kaggle.com/datasets/zeesolver/consumer-behavior-and-shopping-habits-dataset/data> abgerufen werden kann.

Dieses Datenset beinhaltet insgesamt zwei CSV-Dateien `[...].`

## Beschreibung der Datenquelle

Laden wir zuerst die beiden Datensets:

```{r, message=FALSE}
shopping_trends <- read_csv('./data/shopping_trends.csv')
shopping_behavior <- read_csv('./data/shopping_behavior_updated.csv')
```

Nun werfen wir einen kurzen Blick auf die Datenstrukturen.<br>
Zunächst einmal die Datenstruktur des Datensets "Shopping_trends":

```{r}
knitr::kable(head(shopping_trends), caption = "Das Spaltenformat des Datensatzes 'shopping_trends'")
```

Jede Zeile steht für einen Shopping-Trend.

Variable                    |Typ    |Bedeutung
:---------------------------|:------|:------------------------------------------
**Customer ID**             |dbl    | Eindeutige Kunden Identifikationsnummer
**Age**                     |dbl    | Alter des Kundens
**Gender**                  |chr    | Geschlecht des Kundens
**Item Purchased**          |chr    | Gekauftes Produkt
**Category**                |chr    | Kategorie des gekauften Produkts
**Purchase Amount**         |dbl    | Bezahlter Preis
**Location**                |chr    | Ort des Kaufes
**Size**                    |chr    | Konfektionsgröße des gekauften Produkts
**Color**                   |chr    | Farbe des gekauften Produkts
**Season**                  |chr    | Jahreszeit, in welcher der Kauf getätigt wurde
**Review Rating**           |dbl    | Kundenbewertungen zum Produkt
**Subscription Status**     |chr    | Status des Abonnements
**Payment Method**          |chr    | Zahlungsmethode
**Shipping Type**           |chr    | Versandart
**Discount Applied**        |chr    | Rabattcode genutzt?
**Promo Code Used**         |chr    | Werbecode genutzt?
**Previous Purchases**      |dbl    | Vorherige Käufe
**Preferred Payment Method**|chr    | Bevorzugte Zahlungsmethode
**Frequency of Purchases**  |chr    | Häufigkeit von Käufen

```{r}
describe_tbl(shopping_trends)
```

Im Datensatz "Shopping_trends" gibt es **`r nrow(shopping_trends)`** Instazen (Beobachtungen). Keine dieser Instanzen enthalten Werte ohne Angabe (NA), daher müssen wir das Datenset nicht aufgrund fehlender Variablen aufbereiten.<br>
<br>
Nun schauen wir auf die Datenstruktur des Datensets "Shopping_behavior":

```{r}
knitr::kable(head(shopping_behavior), caption = "Das Spaltenformat des Datensatzes'shopping_behavior'")
```

Jede Zeile steht für ein Shopping-Verhalten.

Variable                    |Typ    |Bedeutung
:---------------------------|:------|:------------------------------------
**Customer ID**             |dbl    | Eindeutige Kunden Identifikationsnummer
**Age**                     |dbl    | Alter des Kundens
**Gender**                  |chr    | Geschlecht des Kundens
**Item Purchased**          |chr    | Gekauftes Produkt
**Category**                |chr    | Kategorie des gekauften Produkts
**Purchase Amount**         |dbl    | Bezahlter Preis
**Location**                |chr    | Ort des Kaufes
**Size**                    |chr    | Konfektionsgröße des gekauften Produkts
**Color**                   |chr    | Farbe des gekauften Produkts
**Season**                  |chr    | Jahreszeit, in welcher der Kauf getätigt wurde
**Review Rating**           |dbl    | Kundenbewertungen zum Produkt
**Subscription Status**     |chr    | Status des Abonnements
**Payment Method**          |chr    | Zahlungsmethode
**Shipping Type**           |chr    | Versandart
**Discount Applied**        |chr    | Rabattcode genutzt?
**Promo Code Used**         |chr    | Werbecode genutzt?
**Previous Purchases**      |dbl    | Vorherige Käufe
**Payment Method**          |chr    | Bevorzugte Zahlungsmethode
**Frequency of Purchases**  |chr    | Häufigkeit von Käufen

```{r}
describe_tbl(shopping_behavior)
```

Im Datensatz "Shoping_behavior" gibt es ebenfalls **`r nrow(shopping_behavior)`** Instazen (Beobachtungen). Zudem gibt es keine Instanz, welche Werte ohne Angabe (NA) enthalten. Daher müssen wir, wie beim vorherigen Datensatz  keine fehlenden Variablen aufbereiten.

## Thesen aufstellen

**These 1: Die meisten Personen kaufen wöchentlich ein.**

**These 2: Die meisten Klamotten sind in den Farben Schwarz, Weiß oder Grau.**

**These 3: Die meisten Kunden zahlen Bar.**

**These 4: Die meisten Kunden nutzen keinen Rabattcode.**

**These 5: Männer kaufen weniger ein als Frauen.**

**These 6: Es werden mehr Winter als Sommerklamotten gekauft.**

**These 7: Die meisten Klamotten werden im Norden gekauft.**

**These 8: Die Kategorie "Klamotten" wird am meisten gekauft.**

**These 9: Es kaufen mehr Personen über 40 Jahre ein, als Personen unter 40 Jahren.**

# Untersuchung der Daten (Auf ausreißer)

# Untersuchung der Thesen (mit Methoden der EDA)

## These 1 (Ole)

Histogramm für die Häufigkeit von Einkäufen
Zusammenfassende Statistiken
Drucke das Histogramm und die Zusammenfassung


## These 2 (Ole)

Zunächst schauen wir uns einmal alle vorhandenen Farben an:

```{r}
shopping_behavior |> distinct(Color)
```

Wir sehen, dass es 50 Farben gibt. Nun schauen wir uns die Häufigkeit der Farben an:

```{r}
shopping_behavior |> count(Color)
```

Wir sehen, dass die Farben Schwarz, Weiß und Grau am häufigsten vorkommen. Nun schauen wir uns die Häufigkeit der Farben an, die nicht Schwarz, Weiß oder Grau sind:

```{r}
shopping_behavior |> filter(Color != "Black" & Color != "White" & Color != "Grey") |> count(Color)
```

## These 3 (Ole)

## These 4 (Fabian)
In dieser These wird die Hypothese geprüft, dass die meisten Kunden keine Rabattcodes nutzen würden. 

## These 5 (Fabian)
In dieser These wird die Hypothese geprüft, dass Männer weniger Produkte einkaufen als Frauen. 

## These 6 (Fabian)
In dieser These wird die Hypothese geprüft, dass im Winter mehr Kleidung gekauft wird als im Sommer. 

## These 7 (Sörn)

Zunächst schauen wir uns einmal alle vorhandenen Orte an:

```{r}
shopping_behavior |> distinct(Location)
```

Wir sehen, dass es 50 Orte gibt. Nun schauen wir uns die Häufigkeit der Orte an, sortiert nach der Häufigkeit:

```{r}
shopping_behavior |> count(Location) |> arrange(desc(n))
```



Nun erstellen wir eine Heatmap über dieHäufigkeit der Locations:

```{r}
library(usmap)

df <- data.frame(
  state  = c("Montana", "California", "Idaho", "Illinois", "Alabama", "Minnesota", "Nebraska", "Nevada", "New York", "Delaware",
             "Maryland", "Vermont", "Louisiana", "North Dakota", "Missouri", "New Mexico", "West Virginia","Mississippi", "Arkansas", "Georgia",
             "Indiana", "Kentucky", "Connecticut", "North Carolina", "Maine", "Ohio", "Tennessee", "Texas", "Virginia", "South Carolina",
             "Colorado", "Oklahoma", "Wisconsin", "Oregon", "Pennsylvania", "Michigan", "Washington", "Alaska", "Massachusetts", "New Hampshire",
             "New Hampshire", "Utah", "Wyoming", "South Dakota", "Iowa", "Florida", "New Jersey", "Arizona", "Hawaii", "Kansas",
             "Rhode Island"),
  occurrence = c(96, 95, 93, 92, 89, 88, 87, 87, 87, 86,
                 86, 85, 84, 83, 81, 81, 81, 80, 79, 79,
                 79, 79, 78, 78, 77, 77, 77, 77, 77, 76,
                 75, 75, 75, 74, 74, 73, 73, 72, 72, 71,
                 71, 71, 71, 70, 69, 68, 67, 65, 65, 63,
                 63)
)

plot_usmap(data = df, values = "occurrence", color = "black", labels = TRUE) + 
  scale_fill_continuous(
    low = "white", high = "red", name = "Häufigkeit", label = scales::comma
  ) + theme(legend.position = "right")
```







## These 8 (Sörn)

Zunächst schauen wir uns einmal alle vorhandenen Kategorien an:

```{r}
shopping_behavior |> distinct(Category)
```

Wir sehen, dass es 4 Kategorien gibt: Klamotten, Schuhe, Accessoires und Oberbekleidung Nun schauen wir uns die Häufigkeit der Kategorien an:

```{r}
shopping_behavior |> count(Category)

shopping_behavior |> count(Category) |> ggplot(aes(x = Category, y = n)) + geom_col()
```

Wir sehen, dass die Kategorie "Klamotten" mit 1737 Instanzen am häufigsten vorkommt.Danach folgt die Kategorie "Accessoires" mit 1240 Instanzen. Am seltensten kommen die Kategorien "Schuhe" mit 599 und "Oberbekleidung" mit 324 Instanzen vor.

## These 9 (Sörn)

```{r}
hist(shopping_behavior$Age)
```

Einkauf mit dem höchsten Alter:

```{r, message=FALSE}
shopping_behavior |> arrange(desc(Age)) |> head(1)
```

Einkauf mit dem niedrigsten Alter:

```{r, message=FALSE}
shopping_behavior |> arrange(Age) |> head(1)
```

Berechnen wir Mittelwert und Median.

```{r}
shopping_behavior |> summarise(mean(Age), median(Age))

mean_behavior <- as.double(mean(shopping_behavior$Age))
med_behavior <- as.integer(median(shopping_behavior$Age))
```

Der Mittelwert `r mean_behavior` ist nicht robust gegenüber Ausreißern, deswegen ist der deutlich höher als der Median mit dem Wert `r med_behavior`.

Die Spannweite des Alters ist:

```{r}
max(shopping_behavior$Age) - min(shopping_behavior$Age)
```

Nun erstellen wir einen Boxplot für das Alter:

```{r}
ggplot(shopping_behavior, aes(x = Age)) + 
  geom_boxplot() +
  coord_flip() +
  labs(
    x = "Alter",
    title = "Boxplot der Lebensjahre der Kunden", 
  ) +
  scale_y_discrete(labels = NULL, breaks = NULL)  +
  scale_x_continuous(
    labels = comma_format(big.mark = ".", 
                          decimal.mark = ","))
```


# Anwendung und Beurteilung von Machine-Learning-Modellen

## Modell 1 (Ole)

### Anwendung

### Beurteilung

## Modell 2 (Ole)

### Anwendung

### Beurteilung

## Modell 3 (Fabian)

### Anwendung

### Beurteilung

## Modell 4 (Fabian)

### Anwendung

### Beurteilung

## Modell 5 (Sörn)

### Anwendung

### Beurteilung

## Modell 6 (Sörn)

### Anwendung

### Beurteilung

# Fazit

## Bewertung

Ich finde das sehr Kritisch und nicht schön

## Ideen für weitere Analysen

# Quellen

Datenset: <https://www.kaggle.com/datasets/zeesolver/consumer-behavior-and-shopping-habits-dataset/data>
US-Map: <https://jtr13.github.io/cc19/different-ways-of-plotting-u-s-map-in-r.html>
US-Map 2: <https://cran.r-project.org/web/packages/usmap/vignettes/mapping.html>

# Ehrenwörtliche Erklärung
Hiermit erklären wir, dass wir die vorliegende Studienarbeit (Produktstudie) selbständig angefertigt haben und die Bearbeiter der einzelnen Abschnitte wahrheitsgemäß angegeben haben. Es wurden nur die in der Arbeit ausdrücklich benannten Quellen und Hilfsmittel benutzt. Wörtlich oder sinngemäß übernommenes Gedankengut haben wir als solches kenntlich gemacht. Diese Arbeit hat in gleicher oder ähnlicher Form ganz oder teilweise noch keiner Prüfungsbehörde vorgelegen.

<!-- Unterschriften in HTML -->
<img src="./signatures/OleKepa.png" height="50" width="150"> <img src="./signatures/FabianElsner.png" height="50" width="150"> <img src="./signatures/SoerenBax.png" height="50" width="150">

<!-- Unterschriften in PDF einbinden -->
\includegraphics{"./signatures/OleKepa.png"} \includegraphics{"./signatures/OleKepa.png"} \includegraphics{"./signatures/OleKepa.png"}